<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EV Charging Cost Calculator</title>

    <style>
        /* =========================================================
           GLOBAL BASE STYLES
        ========================================================= */
        :root {
            --bg-main: #05070b;
            --bg-elevated: #10131b;
            --bg-elevated-soft: #141824;
            --accent: #3aa9ff;          /* Electric blue accent */
            --accent-soft: rgba(58, 169, 255, 0.35);
            --text-main: #f5f7ff;
            --text-muted: #a3a7b8;
            --border-subtle: #262a38;
            --danger: #ff4b6a;
            --shadow-soft: 0 18px 45px rgba(0, 0, 0, 0.65);
            --radius-card: 18px;
            --transition-fast: 0.18s ease-out;
            --transition-med: 0.28s ease-out;
        }

        * {
            box-sizing: border-box;
        }

        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
                sans-serif;
            background: radial-gradient(circle at top, #151a26 0, #05070b 55%);
            color: var(--text-main);
        }

        body {
            display: flex;
            flex-direction: column;
            align-items: stretch;
            justify-content: flex-start;
        }

        .hidden {
            display: none !important;
        }

        h1, h2, h3 {
            margin: 0 0 0.5rem 0;
            font-weight: 600;
        }

        p {
            margin: 0.25rem 0 0.75rem 0;
        }

        /* =========================================================
           BUTTONS
        ========================================================= */
        button {
            font-family: inherit;
            border: none;
            cursor: pointer;
            border-radius: 999px;
            padding: 0.65rem 1.4rem;
            font-size: 0.95rem;
            font-weight: 500;
            transition: background-color var(--transition-fast),
                        color var(--transition-fast),
                        box-shadow var(--transition-fast),
                        transform 0.12s ease-out;
        }

        button:focus-visible {
            outline: 2px solid var(--accent);
            outline-offset: 3px;
        }

        .primary-btn {
            background: linear-gradient(135deg, var(--accent), #6ad0ff);
            color: #020308;
            box-shadow: 0 0 18px var(--accent-soft);
        }

        .primary-btn:hover {
            box-shadow: 0 0 26px var(--accent-soft);
            transform: translateY(-1px);
        }

        .secondary-btn {
            background: transparent;
            color: var(--text-main);
            border: 1px solid var(--border-subtle);
        }

        .secondary-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .primary-btn.small,
        .secondary-btn.small {
            padding: 0.45rem 1rem;
            font-size: 0.85rem;
        }

        /* =========================================================
           FULL-SCREEN ENTRY MODAL (M3)
        ========================================================= */
        .entry-modal {
            position: fixed;
            inset: 0;
            background: radial-gradient(circle at top, #151a26 0, #05070b 55%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity var(--transition-med);
        }

        .entry-modal.active {
            opacity: 1;
            pointer-events: auto;
        }

        .entry-modal-content {
            background: radial-gradient(circle at top, #1b2233 0, #10131b 55%);
            border-radius: var(--radius-card);
            padding: 2.2rem 2.4rem;
            max-width: 480px;
            width: 90%;
            box-shadow: var(--shadow-soft);
            border: 1px solid rgba(255, 255, 255, 0.04);
            position: relative;
            transform: translateY(18px);
            opacity: 0;
            transition: opacity var(--transition-med),
                        transform var(--transition-med);
        }

        .entry-modal.active .entry-modal-content {
            opacity: 1;
            transform: translateY(0);
        }

        .entry-modal-content h1 {
            font-size: 1.5rem;
            margin-bottom: 0.4rem;
        }

        .entry-modal-content p {
            color: var(--text-muted);
            margin-bottom: 1.4rem;
        }

        .entry-modal-content button {
            width: 100%;
            margin-bottom: 0.7rem;
        }

        /* =========================================================
           WIZARD CONTAINER (W2-C)
        ========================================================= */
        .wizard {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: radial-gradient(circle at top, #151a26 0, #05070b 55%);
            z-index: 900;
            opacity: 0;
            pointer-events: none;
            transition: opacity var(--transition-med);
        }

        .wizard.active {
            opacity: 1;
            pointer-events: auto;
        }

        /* Progress bar (PB1) */
        .wizard-progress {
            position: absolute;
            top: 0;
            left: 0;
            height: 3px;
            width: 0%;
            background: linear-gradient(90deg, var(--accent), #6ad0ff);
            box-shadow: 0 0 12px var(--accent-soft);
            transition: width 0.25s ease-out;
        }

        /* Wizard card (C2 + G2) */
        .wizard-card {
            background: radial-gradient(circle at top, #1b2233 0, #10131b 55%);
            border-radius: var(--radius-card);
            padding: 2.2rem 2.4rem 2.1rem;
            width: 95%;
            max-width: 520px;
            box-shadow: var(--shadow-soft);
            border: 1px solid rgba(255, 255, 255, 0.04);
            position: relative;
            overflow: hidden;
        }

        .wizard-card::before {
            content: "";
            position: absolute;
            inset: -40%;
            background: radial-gradient(circle at top,
                        rgba(58, 169, 255, 0.12) 0,
                        transparent 55%);
            opacity: 0.9;
            pointer-events: none;
        }

        .wizard-step {
            opacity: 0;
            transform: translateY(18px);
            transition: opacity var(--transition-med),
                        transform var(--transition-med);
            position: absolute;
            inset: 0;
            padding: 2.2rem 2.4rem 2.1rem;
        }

        .wizard-step.active {
            opacity: 1;
            transform: translateY(0);
            position: relative;
        }

        .wizard-step.hidden {
            display: none;
        }

        .wizard-step h2 {
            font-size: 1.4rem;
            margin-bottom: 0.4rem;
        }

        .wizard-note {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-bottom: 1.4rem;
        }

        .wizard-step input[type="number"],
        .wizard-step input[type="text"] {
            width: 100%;
            padding: 0.7rem 0.9rem;
            border-radius: 999px;
            border: 1px solid var(--border-subtle);
            background: rgba(5, 7, 11, 0.85);
            color: var(--text-main);
            font-size: 0.95rem;
            margin-bottom: 1.4rem;
            outline: none;
            transition: border-color var(--transition-fast),
                        box-shadow var(--transition-fast),
                        background-color var(--transition-fast);
        }

        .wizard-step input::placeholder {
            color: #5f6475;
        }

        .wizard-step input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 1px var(--accent-soft);
            background: rgba(5, 7, 11, 0.95);
        }

        .wizard-next-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--accent), #6ad0ff);
            color: #020308;
            box-shadow: 0 0 18px var(--accent-soft);
            min-width: 130px;
        }

        .wizard-next-btn:hover {
            box-shadow: 0 0 26px var(--accent-soft);
            transform: translateY(-1px);
        }

        /* =========================================================
           RESPONSIVE BEHAVIOUR (W2-C)
        ========================================================= */
        @media (max-width: 768px) {
            .wizard-card {
                width: 100%;
                max-width: 100%;
                height: 100%;
                border-radius: 0;
                padding: 2rem 1.4rem 1.8rem;
            }

            .wizard-step {
                padding: 2rem 1.4rem 1.8rem;
            }

            .entry-modal-content {
                max-width: 100%;
                width: 100%;
                height: auto;
                margin: 0 1.2rem;
            }
        }

        /* =========================================================
           FULL APP CONTAINER
        ========================================================= */
        #fullApp {
            max-width: 960px;
            width: 100%;
            margin: 2rem auto 3rem;
            padding: 1.8rem 1.6rem 2.2rem;
            background: rgba(10, 13, 20, 0.96);
            border-radius: 18px;
            border: 1px solid rgba(255, 255, 255, 0.04);
            box-shadow: var(--shadow-soft);
        }

        #fullApp h1 {
            font-size: 1.6rem;
            margin-bottom: 1.2rem;
        }

        .input-section {
            margin-bottom: 1rem;
        }

        .input-section label {
            display: block;
            margin-bottom: 0.25rem;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .input-section input[type="number"],
        .input-section input[type="text"] {
            width: 100%;
            padding: 0.55rem 0.8rem;
            border-radius: 8px;
            border: 1px solid var(--border-subtle);
            background: rgba(5, 7, 11, 0.9);
            color: var(--text-main);
            font-size: 0.9rem;
            outline: none;
            transition: border-color var(--transition-fast),
                        box-shadow var(--transition-fast),
                        background-color var(--transition-fast);
        }

        .input-section input::placeholder {
            color: #5f6475;
        }

        .input-section input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 1px var(--accent-soft);
            background: rgba(5, 7, 11, 0.98);
        }

        #providersContainer {
            margin-bottom: 1rem;
            padding: 0.8rem;
            border-radius: 10px;
            background: rgba(8, 11, 18, 0.9);
            border: 1px dashed var(--border-subtle);
            min-height: 40px;
        }

        #resultsSection {
            margin-top: 1.4rem;
        }

        #resultsOutput {
            margin-bottom: 1rem;
            font-size: 0.95rem;
        }

        canvas#resultsChart {
            width: 100%;
            max-width: 100%;
            height: 260px;
            background: #05070b;
            border-radius: 12px;
            border: 1px solid var(--border-subtle);
            margin-bottom: 1rem;
        }
    </style>
</head>

<body>

<!-- ========================================================= -->
<!--  FULL-SCREEN CHOICE MODAL (M3)                           -->
<!-- ========================================================= -->
<div id="entryChoiceModal" class="entry-modal hidden">
    <div class="entry-modal-content">
        <h1>How would you like to begin?</h1>
        <p>Select an option to continue.</p>

        <button id="startWizardBtn" class="primary-btn">
            Use Guided Setup
        </button>

        <button id="skipWizardBtn" class="secondary-btn">
            Skip Wizard & Go Straight to Calculator
        </button>
    </div>
</div>


<!-- ========================================================= -->
<!--  WIZARD CONTAINER (W2-C + C2 + G2 + T2 + PB1)            -->
<!-- ========================================================= -->
<div id="wizardContainer" class="wizard hidden">

    <!-- Progress Bar -->
    <div id="wizardProgressBar" class="wizard-progress"></div>

    <!-- Wizard Card -->
    <div class="wizard-card">

        <!-- STEP 1 -->
        <div class="wizard-step" data-step="1">
            <h2>How far is your trip?</h2>
            <p class="wizard-note">
                You can change this later to instantly see how the results update.
            </p>
            <input type="number" id="wizTripDistance" placeholder="Enter miles" />
            <button class="wizard-next-btn" data-next="2">Next →</button>
        </div>

        <!-- STEP 2 -->
        <div class="wizard-step hidden" data-step="2">
            <h2>What is your battery capacity?</h2>
            <input type="number" id="wizBatterySize" placeholder="kWh" />
            <button class="wizard-next-btn" data-next="3">Next →</button>
        </div>

        <!-- STEP 3 -->
        <div class="wizard-step hidden" data-step="3">
            <h2>What percentage charge will you start with?</h2>
            <input type="number" id="wizStartSOC" placeholder="%" />
            <button class="wizard-next-btn" data-next="4">Next →</button>
        </div>

        <!-- STEP 4 -->
        <div class="wizard-step hidden" data-step="4">
            <h2>What is your car’s efficiency?</h2>
            <input type="number" id="wizEfficiency" placeholder="Miles per kWh" />
            <button class="wizard-next-btn" data-next="5">Next →</button>
        </div>

        <!-- STEP 5 -->
        <div class="wizard-step hidden" data-step="5">
            <h2>What is your ad‑hoc charging rate?</h2>
            <input type="number" id="wizAdhocRate" placeholder="£ per kWh" />
            <button class="wizard-next-btn" data-next="6">Next →</button>
        </div>

        <!-- STEP 6 -->
        <div class="wizard-step hidden" data-step="6">
            <h2>Would you like to add subscription providers?</h2>
            <p class="wizard-note">You can add more later.</p>

            <button id="wizAddProviderBtn" class="primary-btn small">
                Add Provider
            </button>

            <button class="wizard-next-btn" data-next="7">
                Continue →
            </button>
        </div>

        <!-- STEP 7 -->
        <div class="wizard-step hidden" data-step="7">
            <h2>All set!</h2>
            <p>Your calculator is ready. You can adjust anything once inside.</p>
            <button id="wizFinishBtn" class="primary-btn">
                Go to Calculator →
            </button>
        </div>

    </div>
</div>


<!-- ========================================================= -->
<!--  FULL APP (INITIALLY HIDDEN UNTIL WIZARD COMPLETES)      -->
<!-- ========================================================= -->
<div id="fullApp" class="hidden">

    <!-- Your existing app HTML goes here -->
    <!-- I am preserving your structure exactly as-is -->

    <h1>EV Charging Cost Calculator</h1>

    <div class="input-section">
        <label>Trip Distance (miles):</label>
        <input type="number" id="tripDistance" />
    </div>

    <div class="input-section">
        <label>Battery Size (kWh):</label>
        <input type="number" id="batterySize" />
    </div>

    <div class="input-section">
        <label>Starting State of Charge (%):</label>
        <input type="number" id="startSOC" />
    </div>

    <div class="input-section">
        <label>Efficiency (miles per kWh):</label>
        <input type="number" id="efficiency" />
    </div>

    <div class="input-section">
        <label>Ad‑hoc Charging Rate (£/kWh):</label>
        <input type="number" id="adhocRate" />
    </div>

    <hr />

    <h2>Subscription Providers</h2>
    <div id="providersContainer"></div>
    <button id="addProviderBtn" class="primary-btn small">Add Provider</button>

    <hr />

    <button id="calculateBtn" class="primary-btn">Calculate</button>

    <div id="resultsSection" class="hidden">
        <h2>Results</h2>
        <div id="resultsOutput"></div>
        <canvas id="resultsChart"></canvas>
        <button id="exportPDFBtn" class="secondary-btn">Export as PDF</button>
    </div>

</div>
<script>
    // =========================================================
    // ELEMENT REFERENCES
    // =========================================================
    const entryModal = document.getElementById("entryChoiceModal");
    const startWizardBtn = document.getElementById("startWizardBtn");
    const skipWizardBtn = document.getElementById("skipWizardBtn");

    const wizardContainer = document.getElementById("wizardContainer");
    const wizardSteps = Array.from(
        wizardContainer.querySelectorAll(".wizard-step")
    );
    const wizardProgressBar = document.getElementById("wizardProgressBar");

    const wizTripDistance = document.getElementById("wizTripDistance");
    const wizBatterySize = document.getElementById("wizBatterySize");
    const wizStartSOC = document.getElementById("wizStartSOC");
    const wizEfficiency = document.getElementById("wizEfficiency");
    const wizAdhocRate = document.getElementById("wizAdhocRate");
    const wizAddProviderBtn = document.getElementById("wizAddProviderBtn");
    const wizFinishBtn = document.getElementById("wizFinishBtn");

    const fullApp = document.getElementById("fullApp");

    // Main app inputs
    const tripDistanceInput = document.getElementById("tripDistance");
    const batterySizeInput = document.getElementById("batterySize");
    const startSOCInput = document.getElementById("startSOC");
    const efficiencyInput = document.getElementById("efficiency");
    const adhocRateInput = document.getElementById("adhocRate");

    const addProviderBtn = document.getElementById("addProviderBtn");
    const providersContainer = document.getElementById("providersContainer");

    const calculateBtn = document.getElementById("calculateBtn");
    const resultsSection = document.getElementById("resultsSection");
    const resultsOutput = document.getElementById("resultsOutput");
    const exportPDFBtn = document.getElementById("exportPDFBtn");

    // =========================================================
    // INITIALISATION
    // =========================================================
    document.addEventListener("DOMContentLoaded", () => {
        // FIX: Ensure modal becomes visible
        entryModal.classList.remove("hidden");
        entryModal.classList.add("active");
    });

    // =========================================================
    // ENTRY MODAL LOGIC
    // =========================================================
    startWizardBtn.addEventListener("click", () => {
        entryModal.classList.remove("active");
        setTimeout(() => entryModal.classList.add("hidden"), 250);
        startWizard();
    });

    skipWizardBtn.addEventListener("click", () => {
        entryModal.classList.remove("active");
        setTimeout(() => entryModal.classList.add("hidden"), 250);
        showFullApp();
    });

    // =========================================================
    // WIZARD CORE LOGIC
    // =========================================================
    let currentStep = 1;
    const totalSteps = 7;

    function startWizard() {
        wizardContainer.classList.remove("hidden");
        wizardContainer.classList.add("active");
        fullApp.classList.add("hidden");

        wizardSteps.forEach(step => {
            step.classList.add("hidden");
            step.classList.remove("active");
        });

        currentStep = 1;
        showStep(currentStep);
        updateProgressBar();
    }

    function showStep(stepNumber) {
        wizardSteps.forEach(step => {
            const s = parseInt(step.getAttribute("data-step"), 10);
            if (s === stepNumber) {
                step.classList.remove("hidden");
                void step.offsetWidth; // force reflow
                step.classList.add("active");
            } else {
                step.classList.remove("active");
                step.classList.add("hidden");
            }
        });
    }

    function updateProgressBar() {
        wizardProgressBar.style.width = (currentStep / totalSteps) * 100 + "%";
    }

    const wizardNextButtons = wizardContainer.querySelectorAll(".wizard-next-btn");
    wizardNextButtons.forEach(btn => {
        btn.addEventListener("click", () => {
            const nextStep = parseInt(btn.getAttribute("data-next"), 10);
            if (!validateCurrentStep()) return;
            goToStep(nextStep);
        });
    });

    function goToStep(stepNumber) {
        if (stepNumber < 1 || stepNumber > totalSteps) return;
        currentStep = stepNumber;
        showStep(currentStep);
        updateProgressBar();
    }

    function validateCurrentStep() {
        switch (currentStep) {
            case 1: return validateNumberInput(wizTripDistance);
            case 2: return validateNumberInput(wizBatterySize);
            case 3: return validateNumberInput(wizStartSOC);
            case 4: return validateNumberInput(wizEfficiency);
            case 5: return validateNumberInput(wizAdhocRate);
            default: return true;
        }
    }

    function validateNumberInput(inputEl) {
        const value = inputEl.value.trim();
        if (value === "" || isNaN(Number(value))) {
            inputEl.focus();
            inputEl.classList.add("input-error");
            setTimeout(() => inputEl.classList.remove("input-error"), 600);
            return false;
        }
        return true;
    }

    wizardSteps.forEach(step => {
        step.addEventListener("keydown", e => {
            if (e.key === "Enter") {
                const nextBtn = step.querySelector(".wizard-next-btn");
                if (nextBtn) {
                    e.preventDefault();
                    nextBtn.click();
                }
            }
        });
    });

    // =========================================================
    // WIZARD PROVIDER BUTTON
    // =========================================================
    wizAddProviderBtn.addEventListener("click", () => {
        ensureFullAppProviderPlaceholder();
    });

    function ensureFullAppProviderPlaceholder() {
        const div = document.createElement("div");
        div.textContent = "Provider placeholder (added from wizard).";
        div.style.padding = "0.4rem 0.6rem";
        div.style.marginBottom = "0.4rem";
        div.style.borderRadius = "6px";
        div.style.background = "rgba(20, 24, 36, 0.9)";
        providersContainer.appendChild(div);
    }

    // =========================================================
    // FINISH WIZARD
    // =========================================================
    wizFinishBtn.addEventListener("click", () => {
        syncWizardToMainInputs();
        showFullApp();
        wizardContainer.classList.remove("active");
        setTimeout(() => wizardContainer.classList.add("hidden"), 250);
    });

    function syncWizardToMainInputs() {
        if (wizTripDistance.value.trim()) tripDistanceInput.value = wizTripDistance.value.trim();
        if (wizBatterySize.value.trim()) batterySizeInput.value = wizBatterySize.value.trim();
        if (wizStartSOC.value.trim()) startSOCInput.value = wizStartSOC.value.trim();
        if (wizEfficiency.value.trim()) efficiencyInput.value = wizEfficiency.value.trim();
        if (wizAdhocRate.value.trim()) adhocRateInput.value = wizAdhocRate.value.trim();
    }

    // =========================================================
    // SHOW FULL APP
    // =========================================================
    function showFullApp() {
        wizardContainer.classList.remove("active");
        wizardContainer.classList.add("hidden");
        fullApp.classList.remove("hidden");
    }

    // =========================================================
    // BASIC MAIN APP LOGIC (STUBS)
    // =========================================================
    calculateBtn.addEventListener("click", () => {
        const trip = Number(tripDistanceInput.value || 0);
        const eff = Number(efficiencyInput.value || 0);
        const adhoc = Number(adhocRateInput.value || 0);

        let text = "";
        if (trip > 0 && eff > 0 && adhoc > 0) {
            const kWhNeeded = trip / eff;
            const cost = kWhNeeded * adhoc;
            text = `For a ${trip.toFixed(0)} mile trip, using ad‑hoc charging at £${adhoc.toFixed(2)}/kWh, 
you’d use approximately ${kWhNeeded.toFixed(1)} kWh and pay about £${cost.toFixed(2)}.`;
        } else {
            text = "Enter trip distance, efficiency, and ad‑hoc rate to see a basic estimate.";
        }

        resultsOutput.textContent = text;
        resultsSection.classList.remove("hidden");
    });

    exportPDFBtn.addEventListener("click", () => {
        alert("PDF export: wire this to your existing implementation.");
    });

    addProviderBtn.addEventListener("click", () => {
        ensureFullAppProviderPlaceholder();
    });
</script>
</body>
</html>
